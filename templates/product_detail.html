{% extends "base.html" %}
{% block title %}{{ product.name }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/product_detail.css') }}">
{% endblock %}

{% block content %}

<div style="margin-bottom: 20px;">
    <a href="{{ url_for('products.products') }}" style="color: #007bff; text-decoration: none;">â† PowrÃ³t do listy produktÃ³w</a>
</div>

<div class="product-header">
    <h1 style="margin: 0;">ğŸ“¦ {{ product.name }}</h1>
    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
        <button onclick="editProduct()" class="btn" style="background: #ffc107; color: #000;">
            âœï¸ Edytuj produkt
        </button>
        <button onclick="confirmDeleteProduct()" class="btn btn-danger">
            ğŸ—‘ï¸ UsuÅ„ produkt
        </button>
    </div>
</div>

<div class="product-info">
    <strong>EAN:</strong> {{ product.ean or 'Nie podano' }}<br>
    <strong>Liczba linkÃ³w:</strong> {{ links|length }}<br>
    <!-- Informacje o zamiennikach -->
    {% if product.get('substitute_group') %}
    <strong>Grupa zamiennikÃ³w:</strong> 
    <span style="color: #28a745;">âœ… Tak</span>
    <a href="#substitutes-section" style="margin-left: 10px; color: #007bff; text-decoration: none;">Zobacz zamienniki</a>
    {% else %}
    <strong>Grupa zamiennikÃ³w:</strong> 
    <span style="color: #999;">Brak</span>
    <button onclick="showCreateGroupModal()" class="btn" style="background: #ffc107; color: #000; font-size: 0.8em; padding: 4px 8px; margin-left: 10px;">
        ğŸ”— Dodaj do grupy
    </button>
    {% endif %}
</div>

<div class="product-actions">
    <a href="{{ url_for('products.add_link_to_product', product_id=product.id) }}" 
       class="btn" style="background: #28a745;">
        â• Dodaj link rÄ™cznie
    </a>
    
    <button onclick="findInOtherShops()" class="btn" style="background: #17a2b8;">
        ğŸ” ZnajdÅº w innych sklepach
    </button>
    
    <button onclick="showAvailableShops()" class="btn" style="background: #ffc107; color: #000;">
        ğŸ“Š Zobacz dostÄ™pne sklepy
    </button>
    
    <!-- Przycisk zarzÄ…dzania zamiennikmi -->
    <button onclick="showSubstitutesModal()" class="btn" style="background: #6f42c1; color: white;">
        ğŸ”„ Zamienniki
    </button>
</div>

<!-- Status wyszukiwania -->
<div id="search-status" style="display: none;" class="search-status">
    <h3 style="margin-top: 0;">ğŸ” Wyniki wyszukiwania</h3>
    <div id="search-results">
        <!-- Wyniki bÄ™dÄ… dodawane przez JavaScript -->
    </div>
</div>

<!-- Sekcja linkÃ³w sklepÃ³w -->
<div class="shop-links-container">
    <h2>ğŸª Linki sklepÃ³w ({{ links|length }})</h2>
    
    {% if links %}
        {% for link in links %}
        <div class="shop-link-item">
            <div class="shop-link-content">
                <div class="shop-link-info">
                    <div class="shop-link-name">
                        <a href="{{ url_for('shops.shop_detail', shop_id=link.shop_id) }}" style="color: #495057; font-size: 1.1em; text-decoration: none;">
                            <strong>ğŸª™ {{ link.shop_id }}</strong>
                        </a>
                        {% if link.price %}
                            <span class="price-badge">
                                ğŸ’° {{ "%.2f"|format(link.price_pln) }} PLN
                            </span>
                            {% if link.currency != 'PLN' %}
                                <span class="currency-info">
                                    ({{ "%.2f"|format(link.price) }} {{ link.currency }})
                                </span>
                            {% endif %}
                        {% else %}
                            <span class="price-badge no-price">
                                â“ Brak ceny
                            </span>
                        {% endif %}
                    </div>
                    
                    <div class="shop-link-url">
                        <a href="{{ link.url }}" target="_blank">
                            ğŸ”— {{ link.url[:80] }}{% if link.url|length > 80 %}...{% endif %}
                        </a>
                    </div>
                    
                    <div class="shop-link-meta">
                        ğŸ“… Dodano: {{ link.created_at[:16] if link.created_at else 'Brak daty' }}
                        {% if link.price_updated %}
                            | ğŸ’° Ostatnia cena: {{ link.price_updated }}
                        {% endif %}
                    </div>
                </div>
                
                <!-- Przyciski akcji -->
                <div class="shop-link-actions">
                    <button onclick="editLink('{{ link.shop_id|e }}', '{{ link.url|e }}')" 
                            class="btn" style="background: #ffc107; color: #000; font-size: 0.85em; padding: 5px 10px;">
                        âœï¸ Edytuj
                    </button>
                    <button onclick="fetchPriceForLink('{{ link.shop_id|e }}', '{{ link.url|e }}')" 
                            class="btn btn-fetch-price" style="background: #17a2b8; font-size: 0.85em; padding: 5px 10px;">
                        ğŸ”„ Pobierz cenÄ™
                    </button>
                    <button onclick="confirmDeleteLink('{{ link.shop_id|e }}', '{{ link.url|e }}')" 
                            class="btn btn-danger" style="font-size: 0.85em; padding: 5px 10px;">
                        ğŸ—‘ï¸ UsuÅ„
                    </button>
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div style="text-align: center; color: #666; padding: 40px; background: #f8f9fa; border-radius: 8px;">
            <h3>ğŸ“¦ Brak linkÃ³w dla tego produktu</h3>
            <p>Dodaj linki do sklepÃ³w aby mÃ³c monitorowaÄ‡ ceny</p>
            <a href="{{ url_for('products.add_link_to_product', product_id=product.id) }}" 
               class="btn" style="background: #28a745;">
                â• Dodaj pierwszy link
            </a>
        </div>
    {% endif %}
</div>

<!-- Sekcja zamiennikÃ³w (jeÅ›li istniejÄ…) -->
{% if product.get('substitute_group') %}
<div id="substitutes-section" style="margin: 40px 0;">
    <h2>ğŸ”„ Zamienniki</h2>
    <div id="substitutes-list">
        <!-- Zamienniki bÄ™dÄ… Å‚adowane przez JavaScript -->
    </div>
</div>
{% endif %}

<!-- Modal edycji produktu bÄ™dzie tworzony przez JS -->
<!-- Modal rÄ™cznego wprowadzania ceny bÄ™dzie tworzony przez JS -->
<!-- Modal sklepÃ³w bÄ™dzie tworzony przez JS -->

{% endblock %}

{% block extra_js %}
<script>
    // PrzekaÅ¼ PRODUCT_ID do JavaScript
    window.PRODUCT_ID = {{ product.id }};
</script>
<script src="{{ url_for('static', filename='js/product_detail.js') }}"></script>
{% endblock %}